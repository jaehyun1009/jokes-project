<%- include('../partials/html-head') %>
<%- include('../partials/nav') %>

<script>
  function showPunchline(){
    document.getElementById('show-punchline').style.display = 'none'
    punchline.hidden = false
  }
</script>

<main class="page">
  <a class="sub-title action-link" href="/jokes">Back</a>
  <div class="main-content">
    <h2 class="sub-title"><%= joke.setup %></h2>
    <div class="bottom-section">
    <% if (joke.punchline) { %>
      <button class="action-button" id="show-punchline" onclick="showPunchline()">Show Punchline</button>
      <p id="punchline" hidden><%= joke.punchline %></p>
    <% } %>
    </div>
  </div>
  <br><br>
  <div class="comment-section">
    <h3>Comments</h3>
    <br>
    <div>
      <% if (user) { %>
      <form action="/jokes/<%= joke._id %>" method="POST">
        <p style="font-size:2rem;"><textarea name="content" rows="5" cols="100"></textarea><p>
        <button class="action-button small-button">Post</button>
      </form>
      <% } %>
    </div>
    <table class="table table-striped table-margin">
      <thead>
        <tr>
          <th scope="col" class="col-3"><p>Comment By</p></th>
          <th scope="col" class="col-8"></th>
          <th scope="col" class="col-2"><p>Likes</p></th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
      <% comments.forEach(comment => { %>
        <tr>
          <td><p><%= comment.commenter.name %></p></td>
          <td><p><%= comment.content %></p></td>
          <td><p><%= comment.likes %></p></td>
          <% if (user?.profile._id.equals(comment.commenter._id)){ %>
          <form>
            <td><button class="action-button small-button" type="submit">Delete</button></td>
          </form>
          <% } else { %>
          <td></td>
          <% } %>
        </tr>
      <% }) %>
      </tbody>
    </table>
  </div>
</main>

<%- include('../partials/footer') %>